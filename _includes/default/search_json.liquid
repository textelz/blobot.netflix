{% assign dateFormat = site.data.language.str_date_format | default: '%B %-d, %Y' %}
[
{% if site.posts and site.posts.size > 0 %}
    {% for post in site.posts %}
        {
        {% unless post.excluded %}
            "title"    : "{{ post.title | strip_newlines | escape }}",
            "category" : {{ post.category | default: "" | jsonify }},
            "tags"     : "{{ post.tags | join: ', ' | prepend: " " }}",
            "url"      : "{{ post.url | relative_url }}",
            "date"     : "{{ post.date | date: dateFormat }}",
            "excerpt"  : {{ post.content | strip_html | strip_newlines | strip | truncate: 250 | jsonify }},
            "content"  : {{ post.content | strip_html | strip_newlines | strip | jsonify }}
        {% endunless %}
        }{% unless forloop.last %},{% endunless %}
    {% endfor %}
{% endif %}
{% if site.posts.size > 0 and site.pages.size > 0 %},{% elsif site.posts.size == 0 and site.pages.size > 0 %}{% endif %}
{% for page in site.pages %}
    {
    {% unless page.excluded or page.title == nil %}
        "title"    : "{{ page.title | strip_newlines | escape }}",
        "category" : {{ page.category | default: "" | jsonify }},
        "tags"     : "{{ page.tags | join: ', ' | prepend: " " }}",
        "url"      : "{{ page.url | relative_url }}",
        "date"     : "{{ page.date | date: dateFormat | default: "N/A" }}",
        "excerpt"  : {{ page.content | strip_html | strip_newlines | strip | truncate: 250 | jsonify }},
        "content"  : {{ page.content | strip_html | strip_newlines | strip | jsonify }}
    {% endunless %}
    }{% unless forloop.last %},{% endunless %}
{% endfor %}
{% for collection in site.collections %}
    {% assign collection_name = collection.label %}
    {% unless collection_name == 'posts' %}
        {% assign collection_items = site[collection_name] %}
        {% if collection_items and collection_items.size > 0 %}
            {% for page in collection_items %}
                ,{
                {% if page.excluded or page.title != nil %}
                    "title"    : "{{ page.title | strip_newlines | escape }}",
                    "category" : {{ page.category | default: "" | jsonify }},
                    "tags"     : "{{ page.tags | join: ', ' | prepend: " " }}",
                    "url"      : "{{ page.url | relative_url }}",
                    "date"     : "{{ page.date | date: dateFormat | default: "N/A" }}",
                    "excerpt"  : {{ page.content | strip_html | strip_newlines | strip | truncate: 250 | jsonify }},
                    "content"  : {{ page.content | strip_html | strip_newlines | strip | jsonify }}
                {% endif %}
                }
            {% endfor %}
        {% endif %}
    {% endunless %}
{% endfor %}
]
