{% assign dateFormat = site.data.language.str_date_format | default: '%B %-d, %Y' %}
[
{% comment %} 모든 포스트 수집 (site.posts + 컬렉션) {% endcomment %}
{% assign all_posts = '' | split: '' %}
{% if site.posts and site.posts.size > 0 %}
    {% assign all_posts = site.posts %}
{% endif %}
{% for collection in site.collections %}
    {% unless collection.label == 'posts' or collection.label == 'data' or collection.label == 'portfolio' %}
        {% assign collection_docs = site[collection.label] %}
        {% if collection_docs and collection_docs.size > 0 %}
            {% if all_posts.size > 0 %}
                {% assign all_posts = all_posts | concat: collection_docs %}
            {% else %}
                {% assign all_posts = collection_docs %}
            {% endif %}
        {% endif %}
    {% endunless %}
{% endfor %}
{% if all_posts.size > 0 %}
    {% for post in all_posts %}
        {
        {% unless post.excluded %}
            "title"    : "{{ post.title | strip_newlines | escape }}",
            "category" : {{ post.category | default: "" | jsonify }},
            "tags"     : "{{ post.tags | join: ', ' | prepend: " " }}",
            "url"      : "{{ post.url | relative_url }}",
            "date"     : "{{ post.date | date: dateFormat }}",
            "excerpt"  : {{ post.content | strip_html | strip_newlines | strip | truncate: 250 | jsonify }},
            "content"  : {{ post.content | strip_html | strip_newlines | strip | jsonify }}
        {% endunless %}
        }{% unless forloop.last %},{% endunless %}
    {% endfor %}
{% endif %}
{% if all_posts.size > 0 and site.pages.size > 0 %},{% elsif all_posts.size == 0 and site.pages.size > 0 %}{% endif %}
{% for page in site.pages %}
    {
    {% unless page.excluded or page.title == nil %}
        "title"    : "{{ page.title | strip_newlines | escape }}",
        "category" : {{ page.category | default: "" | jsonify }},
        "tags"     : "{{ page.tags | join: ', ' | prepend: " " }}",
        "url"      : "{{ page.url | relative_url }}",
        "date"     : "{{ page.date | date: dateFormat | default: "N/A" }}",
        "excerpt"  : {{ page.content | strip_html | strip_newlines | strip | truncate: 250 | jsonify }},
        "content"  : {{ page.content | strip_html | strip_newlines | strip | jsonify }}
    {% endunless %}
    }{% unless forloop.last %},{% endunless %}
{% endfor %}
]
